{% extends "inventory/base.html" %}
{% load bill_extras %}
{% load static %}

{% block content %}
<style>
@media print {
  nav, .btn, footer, .navbar, .no-print { display: none !important; }
  body { background: #fff !important; color: #000 !important; }
  .company-header { margin-bottom: 15px; }
  .bill-title { margin-top: 15px; }
}

/* ✔ FIX: Reduce gap between logo and title */
.company-header {
  text-align: center;
}

.company-header img {
  height: 85px;
  display: block;
  margin: 0 auto;
  margin-bottom: 2px !important;   /* reduced from 10px → 2px */
}

.company-header h1 {
  margin-top: 0px !important;      /* make title sit closer to logo */
  margin-bottom: 3px;
}

.company-header p {
  margin: 2px 0;
}
</style>

<div class="company-header">
  <!--<img src="{% static 'inventory/logo.png' %}" alt="Company Logo">-->
  <h1>Company name</h1>

  <p>Details of the company</p>
  <p>Company Address</p>
</div>

<h2 class="bill-title">Bill #{{ bill.id }}</h2>

<p><strong>Customer Name:</strong> {{ bill.customer_name }}</p>
<p><strong>Mobile:</strong> {{ bill.customer_mobile }}</p>
<p><strong>Address:</strong> {{ bill.customer_address }}</p>
<p><strong>Project Manager(s):</strong> {{ bill.project_manager }}</p>
<p><strong>Date:</strong> {{ bill.created_at|date:"M. d, Y, h:i a" }}</p>

<div class="mb-3">
  <a href="{% url 'generate_bill_pdf' bill.id %}" target="_blank" class="btn btn-secondary mb-2 no-print">Download PDF</a>
  <a href="https://wa.me/91{{ bill.customer_mobile }}?text={{ bill|get_bill_message }}" target="_blank" class="btn btn-success mb-2 no-print">Send via WhatsApp</a>
  <a href="#" onclick="window.print();" class="btn btn-primary mb-2 no-print">Print Bill</a>
</div>

<table class="table">
  <thead>
    <tr>
      <th>Item</th>
      <th>Qty</th>
      <th>Rate</th>
      <th>Total</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
    <tr>
      <td>{{ item.product.name }}</td>
      <td>{{ item.quantity }}</td>
      <td>{{ item.price }}</td>
      <td>{{ item.get_cost }}</td>
    </tr>
    {% endfor %}
    <tr class="table-footer">
      <th colspan="3">Grand Total</th>
      <th>{{ bill.total_amount }}</th>
    </tr>
  </tbody>
</table>

{% if request.GET.print %}
<script>
  window.onload = function() { window.print(); }
</script>
{% endif %}

{% endblock %}
